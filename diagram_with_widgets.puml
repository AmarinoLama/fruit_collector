@startuml
skinparam classAttributeIconSize 0
class GameRepository {
  GameRepository? instance
  final Database db
  GameRepository repo
  DatabaseManager dbManager
  final rowsAffected
  +Future<Game?> getGameBySpace({required int space})
  +Future<void> updateGameBySpace({required Game game})
  +Future<int> insertGame({required int space})
  +Future<void> deleteGameBySpace({required int space})
}
class AchievementRepository {
  AchievementRepository? instance
  final Database db
  final repo
  final dbManager
  List<Map<String, Object?>> result
  +Future<Achievement?> getAchievement(int achievementId)
  +Future<GameAchievement?> getGameAchievement(int gameId, int achievementId)
  +Future<void> resetGameAchievements(int gameId)
  +Future<void> updateGameAchievement(GameAchievement gameAchievement)
  +Future<int> insertGameAchievement(int gameId, int achievementId)
}
class LevelRepository {
  LevelRepository? instance
  final Database db
  final repo
  final dbManager
  List<Map<String, Object?>> result
  List<Map<String, Object?>> result
  +Future<Level?> getLevel(int levelId)
  +Future<GameLevel?> getGameLevel(int gameId, int levelId)
  +Future<int> insertGameLevel(GameLevel gameLevel)
  +Future<void> updateGameLevel(GameLevel gameLevel)
}
class GameCharacterRepository {
  GameCharacterRepository? instance
  final Database db
  final repo
  final dbManager
  List<Map<String, Object?>> characters
  final character
  bool unlock
  int rowsAffected
  +Future<void> insertCharactersForGame({required int gameId})
  +Future<void> deleteGameCharactersByGameId({required int gameId})
}
class SettingsRepository {
  SettingsRepository? instance
  final Database db
  final repo
  final dbManager
  +Future<void> insertDefaultsForGame({required int gameId})
  +Future<void> updateSettings(Settings settings)
  +Future<Settings?> getSettings(int gameId)
}
class GameAchievementRepository {
  GameAchievementRepository? instance
  final Database db
  final repo
  final dbManager
  List<Map<String, Object?>> achievements
  final rowsAffected
  +Future<void> insertAchievementsForGame({required int gameId})
}
class CharacterRepository {
  CharacterRepository? instance
  final Database db
  final repo
  final dbManager
  List<Map<String, Object?>> result
  +Future<Character?> getCharacter(int characterId)
  +Future<GameCharacter?> getGameCharacter(int gameId, int characterId)
  +Future<void> resetGameCharacters(int gameId)
  +Future<void> updateGameCharacter(GameCharacter gameCharacter)
  +Future<int> insertGameCharacter(int gameId, int characterId)
}
class GameLevelRepository {
  GameLevelRepository? instance
  final Database db
  num get defaultUnlockedLevels
  final repo
  final dbManager
  List<Map<String, Object?>> levels
  final level
  final rowsAffected
  +Future<void> insertLevelsForGame({required int gameId})
  +Future<void> deleteGameLevelByGameId({required int gameId})
}
class GameLevel {
  int id
  int levelId
  int gameId
  bool completed
  bool unlocked
  int stars
  DateTime dateCompleted
  DateTime lastTimeCompleted
  int? time
  int deaths
  +String toString()
}
class GameCharacter {
  int id
  int gameId
  int characterId
  bool unlocked
  bool equipped
  DateTime dateUnlocked
  +String toString()
}
class GameAchievement {
  int id
  int gameId
  int achievementId
  DateTime dateAchieved
  bool achieved
  +String toString()
}
class Level {
  Player player
  String levelName
  TiledComponent level
  List<CollisionBlock> collisionBlocks
  final Stopwatch levelTimer
  int lastMinDeaths
  int lastMinTime
  int deathCount
  int starsCollected
  int get levelTime
  GameLevel? levelData
  LevelService service
  final text
  final position
  final spawnPointsLayer
  final isVertical
  final offNeg
  final offPos
  LevelService service
  final collisionsLayer
  final backgroundLayer
  final backgroundColor
  final backgroundTile
  +Future<void> chargeLevel(GameLevel? level)
  +void _startLevel()
  +void registerDeath()
  +void stopLevelTimer()
  +void resumeLevelTimer()
  +void _addGameText()
  +void respawnObjects()
  +void _spawningObjects()
  +Future<void> saveLevel()
  +void openDoor(int doorId)
  +void starCollected()
  +void _addCollisions()
  +void addSpawnPoint(var spawnPoint)
  +void addCollisionBlock(CollisionBlock collisionBlock)
  +void removeCollisionBlock(CollisionBlock collisionBlock)
  +bool checkpointEnabled()
  +bool _hasFruits()
  +void _scrollingBackground()
}
class Game {
  int id
  DateTime createdAt
  DateTime lastTimePlayed
  int space
  int currentLevel
  int totalDeaths
  int totalTime
  +String toString()
}
class Character {
  int id
  String name
  String description
  int requiredStars
  +Character copy()
  +String toString()
}
class Achievement {
  int id
  String title
  String description
  int difficulty
  +String toString()
}
class Settings {
  int id
  int gameId
  double hudSize
  double controlSize
  bool isLeftHanded
  bool showControls
  bool isMusicActive
  bool isSoundEnabled
  double gameVolume
  double musicVolume
  +String toString()
}
class AchievementService {
  AchievementService? instance
  final AchievementRepository achievementRepository
  final service
  var gameAchievement
  final achievements
  final gameAchievements
  +Future<void> unlockAchievement(int gameId, int achievementId)
  +Future<void> resetAchievementsForGame(int gameId)
  +Future<GameAchievement?> getGameAchievementByIds({required int gameId, required int achievementId})
}
class GameService {
  GameService? instance
  final GameRepository gameRepository
  final SettingsRepository settingsRepository
  final GameLevelRepository gameLevelRepository
  final GameAchievementRepository gameAchievementRepository
  final GameCharacterRepository gameCharacterRepository
  GameService service
  DateTime epoch
  List<Game> validGames
  Game game
  Game? existing
  int newGameId
  Game newGame
  Game? game
  +Future<void> saveGameBySpace({required Game? game})
  +Future<Game> getLastPlayedOrCreate()
  +Future<void> unlockEverythingForGame({required int space})
  +Future<Game> getOrCreateGameBySpace({required int space})
  +Future<Game?> getGameBySpace({required int space})
  +Future<void> deleteGameBySpace({required int space})
}
class SettingsService {
  SettingsService? instance
  final SettingsRepository settingsRepository
  final service
  +Future<void> updateSettings(Settings settings)
  +Future<Settings?> getSettingsForGame(int gameId)
}
class LevelService {
  LevelService? instance
  final LevelRepository levelRepository
  final service
  final levels
  final gameLevels
  var gameLevel
  final now
  final newId
  final allLevels
  final currentLevelIndex
  final nextLevelId
  var nextGameLevel
  final levels
  +Future<GameLevel?> getGameLevelByGameAndLevelName({required int gameId, required String levelName})
}
class CharacterService {
  CharacterService? instance
  final CharacterRepository characterRepository
  final service
  final gameCharacter
  final characters
  List<GameCharacter> characters
  List<Character> allDefinitions
  GameCharacter? equipped
  List<GameCharacter> unlocked
  final aStars
  final bStars
  GameCharacter selected
  bool isTarget
  Character selectedDef
  final characters
  final gameCharacters
  List<GameCharacter> characters
  List<Character> allDefinitions
  GameCharacter? equipped
  List<GameCharacter> unlocked
  final aStars
  final bStars
  bool isTarget
  +Future<void> unlockCharacter(int gameId, int characterId)
  +Future<void> equipCharacter(int gameId, int characterId)
  +Future<void> resetCharactersForGame(int gameId)
  +Future<String> getEquippedCharacterName(int gameId)
  +Future<Character> getEquippedCharacter(int gameId)
}
class DatabaseManager {
  DatabaseManager? instance
  final Database database
  DatabaseManager manager
  String dbPath
  String dbPath
  Database get database
  +Future<void> resetDatabase()
  +Future<void> _initDatabase()
  +Future<void> initializeDB(Database db)
}
class AchievementManager {
  FruitCollector game
  List<Map<String, dynamic>> allAchievements
  final achievementService
  final achievementData
  final unlockedAchievements
  Achievement achievement
  GameAchievement gameAchievement
  final alreadyUnlocked
  final condition
  final nextAchievement
  +Future<void> evaluate()
  +void _showAchievementUnlocked(Achievement achievement)
  +void tryShowNextToast()
}
class NotificationService {
  final NotificationService instance
  bool initialized
  String localTimeZone
  +Future<void> initialize()
  +Future<void> _requestAndroidNotificationPermission()
  +Future<void> cancelAllNotifications()
}
class CustomHitbox {
  double offsetX
  double offsetY
  double width
  double height
}
class Door {
  int id
  Function(CollisionBlock) addCollisionBlock
  Function(CollisionBlock) removeCollisionBlock
  final textureSize
  final SpriteAnimation closeAnimation
  final SpriteAnimation openAnimation
  CollisionBlock? collisionBlock
  +void _loadAllAnimations()
  +void openDoor()
  +SpriteAnimation _spriteAnimation(String state, int amount)
}
class CollisionBlock <<Widget>> {
  bool isPlatform
  bool isSand
  +Future<void> onLoad()
}
class AlternatingBlock {
  bool isRed
  SpriteComponent spriteComponent
  Sprite blockActive
  Sprite blockInactive
  bool isRedActive
  bool timerStarted
  final List<AlternatingBlock> instances
  RectangleHitbox hitbox
  bool isActive
  final spriteSheet
  +Future<void> onLoad()
  +void _loadSprites()
  +Sprite _getTile(int col, int row)
  +void _startPeriodicToggle()
  +void _updateSprite()
  +void onCollision(Set<Vector2> intersectionPoints, PositionComponent other)
}
class LootBox {
  Function(CollisionBlock) addCollisionBlock
  Function(CollisionBlock) removeCollisionBlock
  Function(dynamic) addSpawnPoint
  String objectInside
  int hp
  final Player player
  CollisionBlock collisionBlock
  final SpriteAnimation idleAnimation
  final SpriteAnimation hitAnimation
  final textureSize
  Vector2 keyPosition
  Stars key
  +void _loadAllAnimations()
  +SpriteAnimation _spriteAnimation(String state, int amount)
  +void collidedWithPlayer()
  +void dropObject()
}
class FallingBlock {
  int fallingDuration
  Vector2 initialPosition
  bool isSideSensible
  SpriteAnimationComponent sprite
  bool isFalling
  double fixedDeltaTime
  double accumulatedTime
  Vector2 fallingVelocity
  bool isOnGround
  bool hasCollided
  bool isPlayerOnPlatform
  Player player
  List<CollisionBlock> collisionBlocks
  final delta
  final realPlayerX
  bool isWithinX
  final playerBottom
  final isOnTop
  final futureBottom
  final blockTop
  final intersectsVertically
  +Future<void> onLoad()
  +void update(double dt)
  +void _startFalling()
  +void _stopFalling()
  +void _comeBack()
  +bool _checkPlayerOnPlatform()
  +bool _checkBlockCollisionBelow(Vector2 delta)
}
class Trampoline {
  double powerBounce
  Function(CollisionBlock) addCollisionBlock
  final textureSize
  final SpriteAnimation idleAnimation
  final SpriteAnimation jumpAnimation
  CollisionBlock collisionBlock
  final Player player
  +void _loadAllAnimations()
  +SpriteAnimation _spriteAnimation(String state, int amount)
  +void collidedWithPlayer()
}
class Saw {
  bool isVertical
  double offNeg
  double offPos
  double moveDirection
  double rangeNeg
  double rangePos
  +void update(double dt)
  +void _moveVertically(double dt)
  +void _moveHorizontally(double dt)
}
class AirEffect <<Widget>> {
  Paint airPaint
  double offsetX
  List<double> horizontalOffsets
  final deviation
  int row
  final deviation
  final lineX
  +void render(Canvas canvas)
  +void update(double dt)
}
class Spike <<Widget>> {
  String wallPosition
  final int cols
  final int rows
  RectangleHitbox hitbox
  final baseSprite
  SpriteComponent spike
  double angleS
  Vector2 positionS
  Vector2 hitboxSize
  Vector2 hitboxRotation
  +Future<void> _loadRepeatedSpikes()
  +void onCollisionStart(Set<Vector2> intersectionPoints, PositionComponent other)
}
class FireBlock <<Widget>> {
  int startIn
  String fireDirection
  Function(CollisionBlock) addCollisionBlock
  final SpriteAnimation onAnimation
  final SpriteAnimation offAnimation
  final SpriteAnimationGroupComponent<FireBlockState> fireSprite
  bool isOn
  final Map<int, int> fireBlockCounters
  CollisionBlock collisionBlock
  RectangleHitbox attackHitbox
  Vector2 collisionPosition
  Vector2 hitboxPosition
  Vector2 spritePosition
  double spriteAngle
  final isFirstInstance
  final isPlayerInside
  +Future<void> onLoad()
  +void onRemove()
  +void rotate()
  +void _loadAnimations()
  +SpriteAnimation _spriteAnimation(String state, int amount)
  +void _startPeriodicToggle()
  +void onCollision(Set<Vector2> intersectionPoints, PositionComponent other)
  +void removeSound()
}
class Fan {
  bool directionRight
  double fanDistance
  Function(CollisionBlock) addCollisionBlock
  final textureSize
  CollisionBlock collisionBlock
  final SpriteAnimation offAnimation
  final SpriteAnimation onAnimation
  final Player player
  final fanDirection
  final Vector2 windVelocity
  Vector2 hitboxSize
  +void createHitbox()
  +void _loadAllAnimations()
  +SpriteAnimation _spriteAnimation(String state, int amount)
  +void collidedWithPlayer()
  +void onCollisionEnd(PositionComponent other)
}
class GameText {
  +void onMount()
  +void render(Canvas canvas)
}
class ConfettiEmitterComponent <<Widget>> {
  Vector2 origin
  int count
  double lifespan
  final random
  final sprite
  final system
  +Future<void> onLoad()
}
class Stars {
  String name
  double stepTime
  bool collected
  final previousBest
  final newStars
  +void collidedWithPlayer()
}
class DeathZone <<Widget>> {
  +Future<void> onLoad()
  +void onCollision(Set<Vector2> intersectionPoints, PositionComponent other)
}
class Player {
  String character
  SpriteAnimation idleAnimation
  SpriteAnimation runningAnimation
  SpriteAnimation jumpingAnimation
  SpriteAnimation fallingAnimation
  SpriteAnimation hitAnimation
  SpriteAnimation appearingAnimation
  SpriteAnimation disappearingAnimation
  SpriteAnimation doubleJumpingAnimation
  SpriteAnimation wallSlideAnimation
  double gravity
  double jumpForce
  double maximunVelocity
  double terminalVelocity
  double moveSpeed
  bool hasReached
  double horizontalMovement
  Vector2 statringPosition
  Vector2 velocity
  Vector2 windVelocity
  bool isOnGround
  bool isOnWall
  bool isOnSand
  bool hasJumped
  int jumpCount
  double fixedDeltaTime
  double accumulatedTime
  bool hasDoubleJumped
  int lastWall
  bool gotHit
  bool isRespawning
  bool isLeftKeyPressed
  bool isRightKeyPressed
  bool isDownPressed
  List<CollisionBlock> collisionBlocks
  CustomHitbox hitbox
  PlayerState playerState
  final isOnRightWall
  final currentWall
  final banana
  +void update(double dt)
  +bool onKeyEvent(KeyEvent event, Set<LogicalKeyboardKey> keysPressed)
  +void onCollisionStart(Set<Vector2> intersectionPoints, PositionComponent other)
  +void onCollision(Set<Vector2> intersectionPoints, PositionComponent other)
  +void _loadAllAnimations()
  +SpriteAnimation _spriteAnimation(String state, int amount, {double stepTime = stepTime})
  +SpriteAnimation _specialSpriteAnimation(String state, int amount)
  +void _updatePlayerMovement(double dt)
  +void _playerJump(double dt)
  +void _updatePlayerState()
  +void _checkHorizontalCollisions()
  +void _applyGravity(double dt)
  +void _checkVerticalCollisions()
  +Future<void> _respawn()
  +Future<void> _animationRespawn()
  +Future<void> _reachedCheckpoint(Checkpoint other)
  +void collidedWithEnemy()
  +void updateCharacter()
  +void loadNewCharacterAnimations()
}
class Fruit {
  String fruit
  AudioPool collectFruit
  double stepTime
  final hitbox
  bool collected
  +void collidedWithPlayer()
}
class Checkpoint {
  bool isLastLevel
  final SpriteAnimation idleAnimation
  final SpriteAnimation flagOutAnimation
  final SpriteAnimation noFlagAnimation
  String route
  +void onCollisionStart(Set<Vector2> intersectionPoints, PositionComponent other)
  +Future<void> _reachedCheckpoint()
  +void _loadAllAnimations()
}
class PeeShooter {
  double range
  int lookDirection
  List<CollisionBlock> collisionBlocks
  Function(dynamic) addSpawnPoint
  final textureSize
  double rangeNeg
  double rangePos
  bool gotStomped
  final Player player
  double fixedDeltaTime
  double accumulatedTime
  bool isAtacking
  bool isDuringCoolDown
  final projectileSize
  Vector2 projectileVelocity
  RectangleHitbox hitbox
  final SpriteAnimation idleAnimation
  final SpriteAnimation attackAnimation
  final SpriteAnimation hitAnimation
  Vector2 velocity
  Vector2 projectilePosition
  Vector2 projectileFixedVelocity
  final playerOffset
  final playerX
  +void update(double dt)
  +void _loadAllAnimations()
  +SpriteAnimation _spriteAnimation(String state, int amount)
  +void _calculateRange()
  +Future<void> attack()
  +void shootProjectile()
  +bool checkPlayerInRange()
  +void collidedWithPlayer()
}
class Ghost {
  int spawnIn
  Vector2 initialPosition
  final SpriteAnimation appearingAnimation
  final SpriteAnimation movingAnimation
  final SpriteAnimation disappearingAnimation
  final Vector2 spriteSize
  final List<Sprite> trailSprites
  double timeSinceLastParticle
  final Player player
  double speed
  bool isLookingRight
  double fixedDeltaTime
  double accumulatedTime
  bool isActive
  final image
  final playerX
  final threshold
  double playerCenter
  double ghostCenter
  +SpriteAnimation _spriteAnimation(String state, int amount)
  +void onRemove()
  +Future<void> _loadTrailSprites()
  +void _spawn()
  +void respawn()
  +void _loadAllAnimations()
  +void update(double dt)
  +void _emitTrailParticle(double dt)
  +void _move(double dt)
  +void lookLeft()
  +void lookRight()
  +void onCollision(Set<Vector2> intersectionPoints, PositionComponent other)
}
class Rock {
  List<CollisionBlock> collisionBlocks
  double offNeg
  double offPos
  RockType type
  Function(dynamic) addSpawnPoint
  Vector2 spawnPosition
  Vector2 spriteSizeRock1
  Vector2 spriteSizeRock2
  Vector2 spriteSizeRock3
  final SpriteAnimation idleAnimation
  final SpriteAnimation runAnimation
  final SpriteAnimation hitAnimation
  final rangeNeg
  final rangePos
  bool isTurningBack
  Vector2 velocity
  double moveDirection
  double gravity
  double maximunVelocity
  double terminalVelocity
  RectangleHitbox hitbox
  final Player player
  bool gotStomped
  double fixedDeltaTime
  double accumulatedTime
  +void update(double dt)
  +void _loadAllAnimations()
  +SpriteAnimation _spriteAnimation(String state, int amount, Vector2 size)
  +void _movement(double dt)
  +void _applyGravity(double dt)
  +void _checkVerticalCollisions()
  +void turnBack(double direction)
  +void splitRock()
  +void collidedWithPlayer()
}
class Bee {
  double offNeg
  double offPos
  List<CollisionBlock> collisionBlocks
  Function(dynamic) addSpawnPoint
  final textureSize
  double rangeNeg
  double rangePos
  double moveDirection
  double targetDirection
  bool gotStomped
  final Player player
  double fixedDeltaTime
  double accumulatedTime
  bool isAtacking
  bool isDuringCoolDown
  final projectileSize
  Vector2 projectileVelocity
  final SpriteAnimation idleAnimation
  final SpriteAnimation attackAnimation
  final SpriteAnimation hitAnimation
  Vector2 velocity
  double beeOffset
  double playerOffset
  Vector2 projectilePosition
  double playerOffset
  double playerRight
  double playerLeft
  double midBeeX
  +void update(double dt)
  +void _loadAllAnimations()
  +void _checkHorizontalCollisions()
  +SpriteAnimation _spriteAnimation(String state, int amount)
  +void _calculateRange()
  +void _movement(double dt)
  +Future<void> attack()
  +void shootProjectile()
  +bool playerInRange()
  +bool playerBelow()
  +void collidedWithPlayer()
}
class Radish {
  double offNeg
  double offPos
  List<CollisionBlock> collisionBlocks
  Vector2 spawnPosition
  final SpriteAnimation idleAnimation
  final SpriteAnimation flyingAnimation
  final SpriteAnimation runAnimation
  final SpriteAnimation hitAnimation
  final textureSize
  RectangleHitbox hitbox
  final rangePos
  final rangeNeg
  double moveDirection
  double sineTime
  bool isFlying
  Vector2 velocity
  double gravity
  double maximunVelocity
  double terminalVelocity
  double groundSpeed
  final Player player
  bool gotStomped
  double fixedDeltaTime
  double accumulatedTime
  final radishBottom
  final blockTop
  final distanceToLeft
  final distanceToRight
  final proximity
  final speedFactor
  +void _loadAllAnimations()
  +SpriteAnimation _spriteAnimation(String state, int amount)
  +void update(double dt)
  +void _checkVerticalCollisions()
  +Future<void> _fly(double dt)
  +void _checkHorizontalCollisions()
  +void _movement(double dt)
  +void turnBack(double direction)
  +void _applyGravity(double dt)
  +void collidedWithPlayer()
}
class SpikeHead {
  bool isReversed
  final SpriteAnimation idleAnimation
  final SpriteAnimation atackDownAnimation
  final SpriteAnimation atackAnimation
  final SpriteAnimation atackTopAnimation
  double stepTime
  final textureSize
  CustomHitbox hitbox
  bool isAtacking
  bool isComingBack
  Player player
  Vector2 initialPosition
  Vector2 velocity
  double fixedDeltaTime
  double accumulatedTime
  var actualPosition
  final rockheadVisionLeft
  final rockheadVisionRight
  final playerY
  final rockheadY
  final playerMid
  final isAligned
  final isAbove
  +void _loadAllStates()
  +SpriteAnimation _spriteAnimation(String state, int amount)
  +void onCollisionStart(Set<Vector2> intersectionPoints, PositionComponent other)
  +void _updateMovement(double dt)
  +void update(double dt)
  +void checkPlayerPosition()
  +void attack(int direction)
  +void comeBack()
}
class PeeProjectile <<Widget>> {
  Vector2 velocity
  Function(dynamic) addSpawnPoint
  final Player player
  final double lifeSpan
  final Vector2 particleSize
  final sprite
  +Future<void> onLoad()
  +void update(double dt)
  +void onCollision(Set<Vector2> intersectionPoints, PositionComponent other)
  +void destroyWithParticles()
}
class BeeProjectile <<Widget>> {
  Vector2 velocity
  Function(dynamic) addSpawnPoint
  final Player player
  final double lifeSpan
  final Vector2 particleSize
  final sprite
  +Future<void> onLoad()
  +void update(double dt)
  +void onCollision(Set<Vector2> intersectionPoints, PositionComponent other)
  +void destroyWithParticles()
}
class Snail {
  double offNeg
  double offPos
  List<CollisionBlock> collisionBlocks
  int doorId
  double runSpeed
  final textureSize
  Random random
  bool isOnGround
  double rangeNeg
  double rangePos
  double moveDirection
  double targetDirection
  bool gotStomped
  final Player player
  double fixedDeltaTime
  double accumulatedTime
  int hp
  double gravity
  double jumpForce
  double maximunVelocity
  double terminalVelocity
  int timeToJump
  int timeToTransformShell
  int timeToTransformSnail
  double noFlipDifference
  RectangleHitbox hitbox
  final SpriteAnimation idleAnimation
  final SpriteAnimation walkAnimation
  final SpriteAnimation hitAnimation
  final SpriteAnimation shellWallHitAnimation
  final SpriteAnimation shellIdleAnimation
  Vector2 velocity
  double snailOffset
  double playerOffset
  double playerOffset
  final confetti
  +void onRemove()
  +void update(double dt)
  +void _loadAllAnimations()
  +void _checkVerticalCollisions()
  +void _applyGravity(double dt)
  +void _checkHorizontalCollisions()
  +SpriteAnimation _spriteAnimation(String state, int amount)
  +void _startJumpTimer()
  +void _startTransformShellTimer()
  +void _startTransformSnailTimer()
  +void _transformSnail()
  +void _transformShell()
  +void _jump()
  +void _calculateRange()
  +void _movement(double dt)
  +bool playerInRange()
  +void collidedWithPlayer()
  +bool isSnail()
  +Future<void> spawnConfetti(Vector2 atPosition)
}
class Chicken {
  double offNeg
  double offPos
  List<CollisionBlock> collisionBlocks
  final textureSize
  double rangeNeg
  double rangePos
  double moveDirection
  double targetDirection
  bool gotStomped
  final Player player
  double fixedDeltaTime
  double accumulatedTime
  final SpriteAnimation idleAnimation
  final SpriteAnimation runAnimation
  final SpriteAnimation hitAnimation
  Vector2 velocity
  double chickenOffset
  double playerOffset
  double playerOffset
  +void update(double dt)
  +void _loadAllAnimations()
  +void _checkHorizontalCollisions()
  +SpriteAnimation _spriteAnimation(String state, int amount)
  +void _calculateRange()
  +void _movement(double dt)
  +bool playerInRange()
  +void _updateState()
  +void collidedWithPlayer()
}
class SoundManager {
  final SoundManager instance
  Map<String, AudioPlayer> players
  DateTime? lastJump
  Timer? rockheadLoopTimer
  bool initialized
  int mutedVolume
  final player
  final player
  final now
  +factory SoundManager()
  +Future<void> init()
  +Future<void> _load(String key, String assetPath)
  +void play(String key, double volume)
  +void playCollectFruit(double volume)
  +void playHit(double volume)
  +void playBounce(double volume)
  +void playDisappear(double volume)
  +void playSmash(double volume)
  +void playRockheadAttacking(double volume)
  +void playAppearGhost(double volume)
  +void playDisappearGhost(double volume)
  +void playFire(double volume)
  +void playGlitch(double volume)
  +void playJump(double volume)
  +void stopRockheadAttackingLoop()
  +Future<void> dispose()
  +void startDefaultBGM(Settings settings)
  +void startBossBGM(Settings settings)
  +void startCreditsBGM(Settings settings)
  +void startMenuBGM(Settings settings)
  +void stopBGM()
  +void pauseAll()
  +void resumeAll()
}
class CreditsScreen <<Widget>> {
  Function gameAdd
  Function gameRemove
  FruitCollector game
  List<_ScrollingCreditLine> creditLines
  Vector2 screenSize
  RectangleComponent fadeOverlay
  _FadeUpdateComponent fadeUpdateComponent
  bool hasFinished
  double durationInSeconds
  double elapsed
  double progress
  double spacing
  double startY
  TextStyle titleStyle
  TextStyle finalStyle
  double titleFontSize
  String rawText
  String trimmed
  bool isFinal
  bool isSectionTitle
  bool isBigTitle
  bool isLast
  String clean
  double yOffset
  String char
  final color
  String clean
  double yOffset
  TextStyle style
  +Future<void> show()
  +void _startFadeOverlay()
  +void _spawnCreditLines()
  +void _onCreditsFinished()
}
class _ScrollingCreditLine {
  double screenHeight
  double speed
  VoidCallback? onRemoved
  +void update(double dt)
}
class _FadeUpdateComponent <<Widget>> {
  +void update(double dt)
}
class DeathScreen {
  Function gameAdd
  Function gameRemove
  FruitCollector game
  final random
  RectangleComponent blackScreen
}
class variable {
  List<TextComponent> xComponents
  final xCount
  final random
  final totalSteps
  final alpha
  final t
  final defeatedTextColor
  final defeatedShadowColor
  final totalSteps
  final alpha
  final t
  final defeatedTextColor
  final defeatedShadowColor
  +Future<void> addBlackScreen(int deaths)
  +Future<void> removeBlackScreen()
}
class ChangeLevelScreen <<Widget>> {
  double durationMs
  VoidCallback onExpandEnd
  double radius
  double elapsed
  TransitionPhase phase
  final double maxRadius
  final Vector2 center
  bool endFunctionExecuted
  bool showLevelSummary
  Size screenSize
  Path path
  final progress
  final eased
  bool get isHud
  +Future<void> onLoad()
  +void render(Canvas canvas)
  +void update(double dt)
  +void startContract()
  +void startExpand()
}
class LevelSummaryOverlay <<Widget>> {
  VoidCallback onContinue
  FruitCollector game
  String get levelName
  int get difficulty
  int get deaths
  int get stars
  int get time
  List<Widget> stars
  int minutes
  int remainingSeconds
  String paddedSeconds
  +Widget build(BuildContext context)
  +Widget _iconValue({required IconData icon, required String value, required TextStyle style})
  +Widget _starsRow(int count)
  +String _formatTime(int seconds)
  +String _difficultyText(int value)
}
class LoadingBanana {
  FruitCollector game
  final buttonSize
  final image
  +Future<void> show()
  +void onGameResize(Vector2 size)
}
class BackgroundTile {
  String color
  double scrollSpeed
}
class CharacterManager {
  FruitCollector game
  List<Map<String, dynamic>> allCharacters
  final characterService
  final charactersData
  final userStars
  Character character
  GameCharacter gameCharacter
  final alreadyUnlocked
  final nextCharacter
  +Future<void> evaluate()
  +void _showCharacterUnlocked(Character character)
  +void tryShowNextToast()
}
class TextStyleSingleton {
  final TextStyleSingleton instance
  +factory TextStyleSingleton()
}
class LevelSelection <<Widget>> {
  double buttonSize
  bool isAvaliable
  +void onTapDown(TapDownEvent event)
}
class AchievementsButton <<Widget>> {
  double buttonSize
  bool isAvaliable
  +void onTapDown(TapDownEvent event)
}
class CustomJoystick <<Widget>> {
  double controlSize
  double leftMargin
  JoystickComponent joystick
  Player player
  bool wasIdle
  Vector2 tapPosition
  double screenWidth
  double screenHeight
  bool isLeftSideTap
  bool isBottomHalf
  +Future<void> onLoad()
  +void _addJoystick()
  +void update(double dt)
  +void onGameResize(Vector2 size)
  +void _updateJoystick()
  +void onTapDown(TapDownEvent event)
  +void onTapUp(TapUpEvent event)
}
class JumpButton <<Widget>> {
  double buttonSize
  SpriteComponent buttonSprite
  +void onGameResize(Vector2 gameSize)
  +void _setSizeAndPosition(Vector2 gameSize)
  +? Vector2(0, gameSize.y / 2)
  +void onTapDown(TapDownEvent event)
  +void onTapUp(TapUpEvent event)
}
class OpenMenuButton <<Widget>> {
  double buttonSize
  bool isAvaliable
  +void onGameResize(Vector2 size)
  +void onTapDown(TapDownEvent event)
}
class ChangePlayerSkinButton <<Widget>> {
  double buttonSize
  bool isAvaliable
  +void onTapDown(TapDownEvent event)
}
class PauseMenu <<Widget>> {
  FruitCollector game
  +Widget build(BuildContext context)
}
class PauseMenuVM {
  FruitCollector game
  final TextStyle textStyle
  String get pauseTitle
  String get resumeLabel
  String get settingsLabel
  String get mainMenuLabel
  bool get canResume
  +void initialize()
  +void resumeGame()
  +void openSettings()
  +void goToMainMenu()
}
class SettingsMenu <<Widget>> {
  FruitCollector game
  +Widget build(BuildContext context)
}
class ToggleMusicVolumeWidget <<Widget>> {
  FruitCollector game
  Function updateMusicVolume
}
class _ToggleMusicVolumeWidgetState <<Widget>> {
  FruitCollector game
  Function updateMusicVolume
  bool isMuted
  double value
  bool isSliderActive
  +Widget build(BuildContext context)
  +double? onChanged(dynamic value)
  +void changeState()
}
class ResizeHUD <<Widget>> {
  FruitCollector game
  Function updateSizeHUD
}
class _ResizeHUDState <<Widget>> {
  FruitCollector game
  Function updateSizeHUD
  double value
  +Widget build(BuildContext context)
  +double? onChanged(dynamic value)
}
class ResizeControls <<Widget>> {
  FruitCollector game
  Function updateSizeControls
  Function updateIsLeftHanded
  Function updateShowControls
}
class _ResizeControlsState <<Widget>> {
  FruitCollector game
  Function updateSizeControls
  Function updateIsLeftHanded
  Function updateShowControls
  double value
  bool isLeftHanded
  bool showControls
  bool get isDesktop
  +Widget build(BuildContext context)
  +double? onChanged(dynamic value)
}
class NumberSlider <<Widget>> {
  FruitCollector game
  double value
  double minValue
  Function(dynamic) onChanged
  bool isActive
  +_NumberSliderState createState()
}
class _NumberSliderState <<Widget>> {
  FruitCollector game
  double value
  Function(dynamic) onChanged
  bool isActive
  +set setValue(double newValue)
  +void didUpdateWidget(covariant NumberSlider oldWidget)
  +Widget build(BuildContext context)
}
class ToggleGameVolumeWidget <<Widget>> {
  FruitCollector game
  Function updateGameVolume
}
class _ToggleGameVolumeWidgetState <<Widget>> {
  FruitCollector game
  Function updateGameVolume
  bool isMuted
  double value
  bool isSliderActive
  +Widget build(BuildContext context)
  +double? onChanged(dynamic value)
  +void changeState()
}
class SettingsMenuViewModel {
  double hudSize
  double controlSize
  double gameVolume
  double musicVolume
  bool isLeftHanded
  bool showControls
  FruitCollector game
  +void init({required FruitCollector game})
  +void updateHudSize(double value)
  +void updateControlSize(double value)
  +void updateGameVolume(double value)
  +void updateMusicVolume(double value)
  +void updateIsLeftHanded(bool value)
  +void updateShowControls(bool value)
  +void applySettings()
  +void backToPauseMenu()
  +void confirmAndBackToPauseMenu()
}
class MainMenu <<Widget>> {
  FruitCollector game
  double topPadding
  bool isMobile
  +Widget build(BuildContext context)
}
class GameSelector <<Widget>> {
  FruitCollector game
  double topPadding
  +Widget build(BuildContext context)
}
class BackgroundWidget <<Widget>> {
}
class _BackgroundWidgetState <<Widget>> {
  List<String> gifPaths
  int currentGif
  Timer gifTimer
  +void initState()
  +void dispose()
  +Widget build(BuildContext context)
}
class SlotButton <<Widget>> {
  Game? gameSlot
  int slotNumber
  Color textColor
  ButtonStyle style
  VoidCallback onPressed
  VoidCallback onDelete
  bool isEmpty
  +Widget build(BuildContext context)
}
class DeleteSlotModal <<Widget>> {
  int slotNumber
  Color textColor
  Color baseColor
  Color borderColor
  VoidCallback onCancel
  VoidCallback onConfirm
  +Widget build(BuildContext context)
}
class MenuButton <<Widget>> {
  String label
  IconData icon
  ButtonStyle style
  VoidCallback onPressed
  bool enabled
  +Widget build(BuildContext context)
}
class TickerProviderStub {
  +Ticker createTicker(TickerCallback onTick)
}
class MainMenuVM {
  FruitCollector game
  TickerProvider vsync
  final AnimationController logoController
  final Animation<double> logoAnimation
  GameService service
  Game lastGame
  bool isSoundOn
  bool isLoading
  bool get isSoundOn
  bool get isLoading
  String get titleText
  String get continueLabel
  String get loadGameLabel
  String get quitLabel
  +Future<void> initialize(BuildContext context)
  +bool isMobile(BuildContext context)
  +Future<void> _loadLastGame()
  +void _applyInitialMusic()
  +void toggleVolume()
  +Future<void> onContinuePressed()
  +void onLoadGamePressed()
  +void onQuitPressed()
  +void dispose()
}
class GameSelectorVM {
  FruitCollector game
  Game? slot1
  Game? slot2
  Game? slot3
  GameService? gameService
  int? slotToDelete
  Game? get slot1
  Game? get slot2
  Game? get slot3
  int? get slotToDelete
  String get titleText
  String get backLabel
  +Future<void> _ensureGameService()
  +Future<void> loadSlots()
  +Future<void> selectSlot(int slotNumber)
  +void confirmDelete(int slotNumber)
  +void cancelDelete()
  +Future<void> deleteSlot(int slotNumber)
  +void goBackToMainMenu()
}
class AchievementMenu <<Widget>> {
  FruitCollector game
  List<Map<String, dynamic>> achievements
}
class _AchievementMenuState <<Widget>> {
  ScrollController scrollController
  double currentOffset
  int currentRow
  int targetRow
  double targetOffset
  double maxWidth
  double maxHeight
  Map<String, dynamic> achievementData
  Achievement achievement
  GameAchievement gameAchievement
  +void _scrollByRow({required bool forward})
  +void _onBack()
  +Widget build(BuildContext context)
  +void dispose()
}
class AchievementDetails <<Widget>> {
  FruitCollector game
  Achievement achievement
  GameAchievement gameAchievement
  double maxWidth
  double maxHeight
  double imageSize
  +Widget build(BuildContext context)
  +void _onBack()
}
class AchievementToast <<Widget>> {
  Achievement achievement
  VoidCallback onDismiss
  FruitCollector game
  +Widget build(BuildContext context)
  +void onTap()
}
class AchievementMenuVM {
  ScrollController scrollController
  List<Map<String, dynamic>> achievements
  double currentOffset
  int currentRow
  int targetRow
  double targetOffset
  +void scrollByRow({required bool forward})
  +void dispose()
}
class BaseModel {
  bool disposed
  String? errorTitle
  String? errorDescription
  String? emptyTitle
  String? emptyDescription
  bool busy
  bool get busy
  bool isEmpty
  bool hasErrors
  +void dispose()
  +void notifyListeners()
  +void setBusy(bool value)
  +void setEmpty({bool empty = true})
  +void setError({String? errorTitle, String? errorDescription})
}
class LevelSelectionMenu <<Widget>> {
  int totalLevels
  FruitCollector game
  ScrollController scrollController
  double maxWidth
  double maxHeight
  double availableWidth
  double calculatedCardsPerRow
  double cardsPerRow
  double cardSize
  double rowHeight
  double currentOffset
  int currentRow
  int targetRow
  double targetOffset
  int level
  bool isUnlocked
  bool isCompleted
  +Widget build(BuildContext context)
  +void onBack()
  +void scrollByRow({required bool forward, required double rowSize})
}
class LevelCard <<Widget>> {
  int levelNumber
  VoidCallback? onTap
  Color cardColor
  Color textColor
  int difficulty
  bool isLocked
  bool isCompleted
  bool isCurrentLevel
  int stars
  int duration
  int deaths
  int clamped
  double t
  HSLColor hsl
  HSLColor lighter
  Color disabledColor
  Color baseBorderColor
  String timeText
  String deathsText
  +Color _calculateBorderColor()
  +Color _lighten(Color color, double amount)
  +Widget build(BuildContext context)
  +? _lighten(cardColor, 0.075)
}
class LevelSelectionMenuVM {
  ScrollController scrollController
  double rowHeight
  double currentOffset
  int currentRow
  int targetRow
  double targetOffset
  +void scrollByRow({required bool forward, required double rowSize})
  +void dispose()
}
class CharacterToast <<Widget>> {
  Character character
  VoidCallback onDismiss
  FruitCollector game
  +Widget build(BuildContext context)
  +void onTap()
}
class CharacterSelection <<Widget>> {
  FruitCollector game
  double maxWidth
  double maxHeight
  double avatarSize
  +Widget build(BuildContext context)
}
class CharacterCardFlip <<Widget>> {
  double angle
  bool isFrontVisible
  bool isUnlocked
  Character character
  double size
  VoidCallback onTap
  +Widget build(BuildContext context)
  +? _buildFront()
  +Widget _buildFront()
  +Widget _buildBack()
}
class CharacterSelectionVM {
  final AnimationController animationController
  final Animation<double> rotation
  bool isFront
  FruitCollector game
  int selectedCharacterIndex
  int numCharacters
  final int userStars
  Character get currentCharacter
  GameCharacter get currentGameCharacter
  double get angle
  +void _notifyListeners()
  +void refreshFromGame()
  +void _initializeData()
  +void nextCharacter()
  +void previousCharacter()
  +void selectCharacter()
  +void goBack()
  +void flipCard()
  +void dispose()
}
class BaseWidget {
  T? model
  Widget? child
  +final Function(T)
  +final Function(T)
}
class _BaseWidgetState <<Widget>> {
  T? model
  +void initState()
  +Widget build(BuildContext context)
}
class FruitCollector <<Widget>> {
  CameraComponent cam
  GameService? gameService
  LevelService? levelService
  SettingsService? settingsService
  AchievementService? achievementService
  CharacterService? characterService
  Player player
  Level level
  Character character
  Settings settings
  bool isOnMenu
  List<Map<String, dynamic>> levels
  List<Map<String, dynamic>> achievements
  List<Map<String, dynamic>> characters
  bool duringBlackScreen
  bool duringRemovingBlackScreen
  CustomJoystick customJoystick
  ChangePlayerSkinButton? changeSkinButton
  OpenMenuButton? menuButton
  LevelSelection? levelSelectionButton
  AchievementsButton? achievementsButton
  JumpButton? jumpButton
  bool isJoystickAdded
  final Vector2 leftControlPosition
  final AchievementManager achievementManager
  final CharacterManager characterManager
  bool isShowingAchievementToast
  bool isShowingCharacterToast
  Map<String, List<dynamic>> pendingToasts
  Achievement? currentShowedAchievement
  int? currentMenuIndexShowedCharacter
  Character? currentToastShowedCharacter
  Achievement? currentAchievement
  GameAchievement? currentGameAchievement
  Map<int, int> levelTimes
  Map<int, int> levelDeaths
  final soundManager
  final pixelAdventure
  final pixelAdventure
  GameService service
  int currentLevel
  GameLevel currentGameLevel
  GameLevel nextGameLevel
  final service
  final gameDeaths
  double width
  double height
  Size fixedSize
  +Future<void> chargeSlot(int space)
  +void loadButtonsAndHud()
  +void initializateButtons()
  +void addOverlays()
  +void reloadAllButtons()
  +void removeControls()
  +void addAllButtons()
  +void updateGlobalStats()
  +Future<void> completeLevel()
  +void _loadActualLevel()
  +void addJoystick()
  +Future<void> getGameService()
  +Future<void> getLevelService()
  +Future<void> getAchievementService()
  +Future<void> getCharacterService()
  +Future<void> getSettingsService()
  +void toggleBlockButtons(bool isLocked)
  +void toggleBlockWindowResize(bool isLocked)
  +void updateCharacter()
  +void pauseEngine()
  +void resumeEngine()
}
class CollisionableWithHitbox <<Mixin>> {
}
class PlayerCollidable <<Mixin>> {
}
GameRepository --> GameRepository
GameRepository --> DatabaseManager
AchievementRepository --> AchievementRepository
LevelRepository --> LevelRepository
GameCharacterRepository --> GameCharacterRepository
SettingsRepository --> SettingsRepository
GameAchievementRepository --> GameAchievementRepository
CharacterRepository --> CharacterRepository
GameLevelRepository --> GameLevelRepository
Level --> Player
Level --> GameLevel
Level --> LevelService
AchievementService --> AchievementService
GameService --> GameService
GameService --> Game
SettingsService --> SettingsService
LevelService --> LevelService
CharacterService --> CharacterService
CharacterService --> GameCharacter
CharacterService --> Character
DatabaseManager --> DatabaseManager
AchievementManager --> FruitCollector
AchievementManager --> Achievement
AchievementManager --> GameAchievement
Door --> CollisionBlock
AlternatingBlock --> CollisionBlock
LootBox --> CollisionBlock
LootBox --> Stars
FallingBlock --> CollisionBlock
FallingBlock --> Player
Trampoline --> CollisionBlock
FireBlock --> CollisionBlock
Fan --> CollisionBlock
Player --> CustomHitbox
SpikeHead --> CustomHitbox
SpikeHead --> Player
CreditsScreen --> FruitCollector
CreditsScreen --> _FadeUpdateComponent
DeathScreen --> FruitCollector
LevelSummaryOverlay --> FruitCollector
LoadingBanana --> FruitCollector
CharacterManager --> FruitCollector
CharacterManager --> Character
CharacterManager --> GameCharacter
CustomJoystick --> Player
PauseMenu --> FruitCollector
PauseMenuVM --> FruitCollector
SettingsMenu --> FruitCollector
_ToggleMusicVolumeWidgetState --> ToggleMusicVolumeWidget
_ToggleMusicVolumeWidgetState --> FruitCollector
ToggleMusicVolumeWidget --> FruitCollector
_ResizeHUDState --> ResizeHUD
_ResizeHUDState --> FruitCollector
ResizeHUD --> FruitCollector
_ResizeControlsState --> ResizeControls
_ResizeControlsState --> FruitCollector
ResizeControls --> FruitCollector
_NumberSliderState --> NumberSlider
_NumberSliderState --> FruitCollector
NumberSlider --> FruitCollector
_ToggleGameVolumeWidgetState --> ToggleGameVolumeWidget
_ToggleGameVolumeWidgetState --> FruitCollector
ToggleGameVolumeWidget --> FruitCollector
SettingsMenuViewModel --> FruitCollector
MainMenu --> FruitCollector
GameSelector --> FruitCollector
_BackgroundWidgetState --> BackgroundWidget
SlotButton --> Game
MainMenuVM --> FruitCollector
MainMenuVM --> GameService
MainMenuVM --> Game
GameSelectorVM --> FruitCollector
GameSelectorVM --> Game
GameSelectorVM --> GameService
_AchievementMenuState --> AchievementMenu
_AchievementMenuState --> Achievement
_AchievementMenuState --> GameAchievement
AchievementMenu --> FruitCollector
AchievementDetails --> FruitCollector
AchievementDetails --> Achievement
AchievementDetails --> GameAchievement
AchievementToast --> Achievement
AchievementToast --> FruitCollector
LevelSelectionMenu --> FruitCollector
CharacterToast --> Character
CharacterToast --> FruitCollector
CharacterSelection --> FruitCollector
CharacterCardFlip --> Character
CharacterSelectionVM --> BaseModel
CharacterSelectionVM --> FruitCollector
FruitCollector --> GameService
FruitCollector --> LevelService
FruitCollector --> SettingsService
FruitCollector --> AchievementService
FruitCollector --> CharacterService
FruitCollector --> Player
FruitCollector --> Level
FruitCollector --> Character
FruitCollector --> Settings
FruitCollector --> CustomJoystick
FruitCollector --> ChangePlayerSkinButton
FruitCollector --> OpenMenuButton
FruitCollector --> LevelSelection
FruitCollector --> AchievementsButton
FruitCollector --> JumpButton
FruitCollector --> Achievement
FruitCollector --> GameAchievement
FruitCollector --> GameLevel
@enduml
